<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Money Buddy - Student Expenses Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
/* Default Theme: Rainbow Splash */
:root {
--primary: #FF6B6B; /* Coral Red */
--secondary: #4ECDC4; /* Turquoise */
--accent: #FFCD3C; /* Sunny Yellow */
--light: #F7FFF7; /* Off-white */
--dark: #2C3E50; /* Dark Blue-Gray */
--background-color: #E0F7FA; /* Light Cyan */
--card-border: #A2D9CE; /* Soft Green-Blue */
--floating-element-color: #FFD166; /* Pastel Orange */
}

/* Theme 1: Candy Land */
[data-theme="candy-land"] {
--primary: #FF9AA2; /* Pastel Pink */
--secondary: #B5EAD7; /* Mint Green */
--accent: #C7CEEA; /* Lavender */
--light: #FFF9F9;
--dark: #5D5D81;
--background-color: #FDE2E4; /* Light Pink */
--card-border: #FFB7B2;
--floating-element-color: #FFD1DC; /* Light Pink */
}

/* Theme 2: Ocean Adventure */
[data-theme="ocean-adventure"] {
--primary: #6DD5ED; /* Sky Blue */
--secondary: #2196F3; /* Blue */
--accent: #FFC107; /* Amber */
--light: #E3F2FD;
--dark: #1A237E;
--background-color: #BBDEFB; /* Light Blue */
--card-border: #90CAF9;
--floating-element-color: #81D4FA; /* Light Blue */
}

/* Theme 3: Forest Friends */
[data-theme="forest-friends"] {
--primary: #8BC34A; /* Light Green */
--secondary: #4CAF50; /* Green */
--accent: #FFEB3B; /* Yellow */
--light: #F1F8E9;
--dark: #33691E;
--background-color: #DCEDC8; /* Pale Green */
--card-border: #C5E1A5;
--floating-element-color: #A5D6A7; /* Medium Green */
}

/* Theme 4: Space Explorer */
[data-theme="space-explorer"] {
--primary: #9C27B0; /* Purple */
--secondary: #673AB7; /* Deep Purple */
--accent: #FF4081; /* Pink Accent */
--light: #EDE7F6;
--dark: #212121;
--background-color: #D1C4E9; /* Light Purple */
--card-border: #B39DDB;
--floating-element-color: #E0BBE4; /* Light Purple */
}

/* Theme 5: Sunny Day */
[data-theme="sunny-day"] {
--primary: #FFC107; /* Amber */
--secondary: #FF9800; /* Orange */
--accent: #FF5722; /* Deep Orange */
--light: #FFFDE7;
--dark: #E65100;
--background-color: #FFECB3; /* Light Yellow */
--card-border: #FFE082;
--floating-element-color: #FFECB3; /* Light Yellow */
}


body {
font-family: 'Quicksand', sans-serif; /* Changed to Quicksand for readability and cuteness */
background-color: var(--background-color);
color: var(--dark);
min-height: 100vh;
display: flex;
justify-content: center;
align-items: center;
padding: 20px;
overflow-x: hidden; /* Allow vertical scrolling, hide horizontal overflow */
position: relative;
}

.container {
max-width: 900px;
width: 100%;
background-color: var(--light);
border-radius: 25px; /* Softer corners */
box-shadow: 0 15px 30px rgba(0,0,0,0.15); /* Stronger shadow */
overflow: hidden; /* Keep content within rounded borders */
position: relative;
border: 6px solid var(--primary); /* Thicker, more prominent border */
z-index: 10; /* Ensure container is above floating elements */
}

.header {
background-color: var(--primary);
color: white;
padding: 15px 20px;
text-align: center;
font-size: 2rem; /* Larger font */
font-weight: bold;
border-bottom: 6px dashed white; /* Thicker dashed border */
display: flex;
flex-wrap: wrap; /* Allow items to wrap on smaller screens */
justify-content: space-between;
align-items: center;
position: relative;
}

.header .emoji {
flex-shrink: 0; /* Prevent emojis from shrinking */
}

.header .btn-logout {
margin-left: auto; /* Push logout button to the right */
}

/* Adjust header font size for smaller screens */
@media (max-width: 640px) {
.header {
font-size: 1.5rem;
padding: 10px 15px;
flex-direction: column; /* Stack items vertically */
gap: 10px; /* Space between stacked items */
}
.header .btn-logout {
margin-left: 0; /* Reset margin for stacking */
width: 100%; /* Full width button */
}
.theme-picker {
position: static; /* Allow theme picker to flow naturally */
justify-content: center; /* Center dots when stacked */
width: 100%;
}
}


.section {
padding: 20px;
transition: all 0.3s ease;
}

/* Card styles */
.card {
background-color: var(--light);
border-radius: 20px; /* Softer corners */
padding: 20px; /* More padding */
margin-bottom: 20px; /* More margin */
border: 4px dashed var(--card-border); /* Thicker dashed border */
box-shadow: 0 5px 10px rgba(0,0,0,0.05); /* Subtle shadow */
}

.smart-card {
background: linear-gradient(135deg, var(--secondary), #3DDAB8); /* Use secondary color */
color: white;
border-radius: 20px;
padding: 20px;
margin-bottom: 20px;
box-shadow: 0 8px 20px rgba(46, 196, 182, 0.4); /* Stronger shadow */
position: relative;
overflow: hidden;
}

.smart-card:before {
content: "‚ú®"; /* More playful emoji */
position: absolute;
font-size: 120px; /* Larger emoji */
right: -40px;
bottom: -40px;
opacity: 0.25; /* Slightly more visible */
transform: rotate(-15deg); /* Add a slight rotation */
}

.tab {
display: none;
}

.tab.active {
display: block;
animation: fadeIn 0.6s ease-out; /* Slower, smoother fade */
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}

/* Form styles */
.form-group {
margin-bottom: 18px; /* More spacing */
}

label {
display: block;
margin-bottom: 8px; /* More spacing */
font-weight: bold;
color: var(--dark);
font-size: 1.1rem; /* Slightly larger label font */
}

input {
width: 100%;
padding: 12px; /* More padding */
border: 3px solid var(--primary); /* Thicker border */
border-radius: 12px; /* Softer corners */
font-size: 17px; /* Slightly larger font */
transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); /* Smoother transition */
background-color: var(--light);
color: var(--dark);
}

input:focus {
border-color: var(--secondary);
box-shadow: 0 0 8px rgba(var(--secondary), 0.5); /* More prominent shadow */
outline: none;
transform: scale(1.01); /* Slight scale on focus */
}

/* Button styles */
.btn {
background-color: var(--primary);
color: white;
border: none;
padding: 12px 25px; /* More padding */
border-radius: 12px; /* Softer corners */
font-size: 17px; /* Larger font */
cursor: pointer;
transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
font-weight: bold;
display: inline-flex;
align-items: center;
justify-content: center;
box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.btn i {
margin-right: 10px; /* More space for icon */
font-size: 1.2em; /* Larger icon */
}

.btn:hover {
background-color: var(--accent); /* Change to accent color on hover */
transform: translateY(-3px) scale(1.02); /* More pronounced hover effect */
box-shadow: 0 8px 16px rgba(var(--primary), 0.4);
}

.btn-secondary {
background-color: var(--secondary);
}

.btn-secondary:hover {
background-color: #3DDAB8; /* A specific shade for secondary hover */
box-shadow: 0 8px 16px rgba(var(--secondary), 0.4);
}

.btn-small {
padding: 8px 15px; /* Adjusted padding */
font-size: 15px; /* Adjusted font size */
border-radius: 10px;
}

/* Table styles */
table {
width: 100%;
border-collapse: separate; /* Use separate for rounded corners */
border-spacing: 0; /* Remove spacing */
margin-top: 20px; /* More margin */
border-radius: 15px; /* Rounded table corners */
overflow: hidden; /* Ensure rounded corners apply */
}

th, td {
border: 1px solid var(--card-border); /* Lighter border */
padding: 12px; /* More padding */
text-align: left;
}

th {
background-color: var(--primary);
color: white;
font-weight: bold;
font-size: 1.1rem;
}

tr:nth-child(even) {
background-color: rgba(var(--primary), 0.05); /* Lighter stripe */
}

/* Make table responsive */
.table-responsive {
overflow-x: auto; /* Enable horizontal scrolling for table */
-webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
}

/* Toggle switch (if used) */
.switch {
position: relative;
display: inline-block;
width: 60px;
height: 34px;
}

.switch input {
opacity: 0;
width: 0;
height: 0;
}

.slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: #ccc;
transition: .4s;
border-radius: 34px;
}

.slider:before {
position: absolute;
content: "";
height: 26px;
width: 26px;
left: 4px;
bottom: 4px;
background-color: white;
transition: .4s;
border-radius: 50%;
}

input:checked + .slider {
background-color: var(--secondary);
}

input:checked + .slider:before {
transform: translateX(26px);
}

/* Fun elements */
.emoji {
font-size: 28px; /* Larger emojis */
margin-right: 8px;
vertical-align: middle;
}

.progress-container {
background-color: #e0e0e0; /* Lighter background */
border-radius: 15px; /* Softer corners */
height: 25px; /* Taller progress bar */
margin: 15px 0;
overflow: hidden;
box-shadow: inset 0 2px 5px rgba(0,0,0,0.1); /* Inner shadow */
}

.progress-bar {
height: 100%;
background-color: var(--secondary);
transition: width 0.6s ease-out; /* Smoother transition */
display: flex;
align-items: center;
justify-content: center;
color: white;
font-size: 14px; /* Larger font */
font-weight: bold;
border-radius: 15px 0 0 15px; /* Rounded left side */
}

.savings-bubble {
position: fixed;
bottom: 30px; /* Slightly higher */
right: 30px; /* Slightly more to the right */
width: 70px; /* Larger bubble */
height: 70px;
background-color: var(--accent);
color: white;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 30px; /* Larger icon */
box-shadow: 0 6px 12px rgba(0,0,0,0.25); /* Stronger shadow */
cursor: pointer;
z-index: 100;
animation: bounce 2s infinite ease-in-out; /* Smoother bounce */
border: 3px solid white; /* White border */
}

@keyframes bounce {
0%, 100% { transform: translateY(0); }
50% { transform: translateY(-20px); } /* More pronounced bounce */
}

/* Floating elements background */
.floating-element {
position: absolute;
background-color: var(--floating-element-color);
border-radius: 50%;
opacity: 0.6;
animation: float 15s infinite ease-in-out;
z-index: 1; /* Behind the container */
pointer-events: none; /* Ensure floating elements don't block clicks */
}

@keyframes float {
0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0.6; }
25% { transform: translateY(-20px) translateX(10px) rotate(10deg); opacity: 0.7; }
50% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0.6; }
75% { transform: translateY(20px) translateX(-10px) rotate(-10deg); opacity: 0.7; }
100% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0.6; }
}

/* Logout button in header (Cute, dynamic, colorful icon) */
.header .btn-logout {
background-color: white;
color: var(--primary);
border: 2px solid var(--primary);
padding: 8px 15px;
border-radius: 20px;
font-size: 1rem;
font-weight: bold;
display: flex;
align-items: center;
box-shadow: 0 2px 5px rgba(0,0,0,0.1);
transition: all 0.3s ease;
}

.header .btn-logout i {
color: var(--accent); /* Cute color for icon */
margin-right: 5px;
font-size: 1.1em;
}

.header .btn-logout:hover {
background-color: var(--primary);
color: white;
transform: scale(1.05); /* More pronounced hover effect */
box-shadow: 0 4px 8px rgba(var(--primary), 0.3);
}

/* Theme picker styles */
.theme-picker {
position: absolute;
top: 15px;
left: 20px;
z-index: 101; /* Above everything */
display: flex;
gap: 8px;
}

.theme-dot {
width: 25px;
height: 25px;
border-radius: 50%;
cursor: pointer;
border: 3px solid white;
box-shadow: 0 2px 5px rgba(0,0,0,0.2);
transition: transform 0.2s ease, border-color 0.2s ease;
}

.theme-dot:hover {
transform: scale(1.15);
}

.theme-dot.active {
border-color: var(--accent);
transform: scale(1.2);
}

/* Specific theme dot colors */
.theme-dot[data-theme-name="rainbow-splash"] { background-color: #FF6B6B; }
.theme-dot[data-theme-name="candy-land"] { background-color: #FF9AA2; }
.theme-dot[data-theme-name="ocean-adventure"] { background-color: #6DD5ED; }
.theme-dot[data-theme-name="forest-friends"] { background-color: #8BC34A; }
.theme-dot[data-theme-name="space-explorer"] { background-color: #9C27B0; }
.theme-dot[data-theme-name="sunny-day"] { background-color: #FFC107; }

/* Responsive adjustments for summary grid */
@media (max-width: 768px) {
.grid.grid-cols-3 {
grid-template-columns: repeat(1, minmax(0, 1fr)); /* Stack on small screens */
}
}

/* Adjust padding for smaller screens */
@media (max-width: 480px) {
body {
padding: 10px;
}
.container {
border-width: 3px; /* Thinner border on very small screens */
}
.section {
padding: 15px;
}
.card {
padding: 15px;
margin-bottom: 15px;
}
.btn {
padding: 10px 20px;
font-size: 16px;
}
.btn-small {
padding: 6px 12px;
font-size: 14px;
}
input {
padding: 10px;
font-size: 16px;
}
label {
font-size: 1rem;
}
.emoji {
font-size: 24px;
}
.smart-card:before {
font-size: 80px;
right: -20px;
bottom: -20px;
}
}

/* New styles for motivational messages */
.motivational-message {
font-size: 1.2rem;
font-weight: bold;
color: var(--primary); /* Use primary color for emphasis */
text-align: center;
margin-top: 15px;
padding: 10px;
border-radius: 10px;
background-color: rgba(var(--accent), 0.1); /* Light background with accent color */
animation: pulse 1.5s infinite alternate; /* Add a subtle pulse animation */
}

@keyframes pulse {
from { transform: scale(1); opacity: 1; }
to { transform: scale(1.02); opacity: 0.9; }
}

/* Styles for the new download advertisement tab */
.download-ad-card {
background: linear-gradient(135deg, var(--primary), var(--accent));
color: white;
border-radius: 25px;
padding: 30px;
margin-bottom: 20px;
box-shadow: 0 10px 25px rgba(0,0,0,0.2);
text-align: center;
position: relative;
overflow: hidden;
animation: popIn 0.8s ease-out;
}

@keyframes popIn {
from { transform: scale(0.8); opacity: 0; }
to { transform: scale(1); opacity: 1; }
}

.download-ad-card h2 {
font-size: 2.5rem;
font-weight: bold;
margin-bottom: 15px;
text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

.download-ad-card p {
font-size: 1.3rem;
margin-bottom: 25px;
line-height: 1.5;
}

.download-ad-card .btn-download {
background-color: white;
color: var(--primary);
border: none;
padding: 15px 35px;
border-radius: 30px;
font-size: 1.5rem;
font-weight: bold;
cursor: pointer;
transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
box-shadow: 0 5px 15px rgba(0,0,0,0.2);
display: inline-flex;
align-items: center;
justify-content: center;
}

.download-ad-card .btn-download i {
margin-right: 12px;
font-size: 1.3em;
color: var(--secondary); /* Use secondary color for icon */
}

.download-ad-card .btn-download:hover {
transform: translateY(-5px) scale(1.05);
box-shadow: 0 10px 20px rgba(0,0,0,0.3);
color: var(--secondary);
}

.download-ad-card .emoji-overlay {
position: absolute;
font-size: 150px;
opacity: 0.1;
pointer-events: none;
animation: rotateAndFade 20s infinite linear;
}

.download-ad-card .emoji-overlay.top-left {
top: -30px;
left: -30px;
transform: rotate(20deg);
}

.download-ad-card .emoji-overlay.bottom-right {
bottom: -30px;
right: -30px;
transform: rotate(-20deg);
animation-delay: 5s;
}

@keyframes rotateAndFade {
0% { transform: rotate(0deg) scale(1); opacity: 0.1; }
50% { transform: rotate(180deg) scale(1.1); opacity: 0.15; }
100% { transform: rotate(360deg) scale(1); opacity: 0.1; }
}

</style>
</head>
<body>
<!-- Floating Background Elements Container -->
<div id="floating-elements-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden;"></div>

<div class="container">
<!-- Header Section -->
<div class="header">
<!-- Theme Picker -->
<div class="theme-picker" id="theme-picker">
<div class="theme-dot active" data-theme-name="rainbow-splash" style="background-color: #FF6B6B;" title="Rainbow Splash"></div>
<div class="theme-dot" data-theme-name="candy-land" style="background-color: #FF9AA2;" title="Candy Land"></div>
<div class="theme-dot" data-theme-name="ocean-adventure" style="background-color: #6DD5ED;" title="Ocean Adventure"></div>
<div class="theme-dot" data-theme-name="forest-friends" style="background-color: #8BC34A;" title="Forest Friends"></div>
<div class="theme-dot" data-theme-name="space-explorer" style="background-color: #9C27B0;" title="Space Explorer"></div>
<div class="theme-dot" data-theme-name="sunny-day" style="background-color: #FFC107;" title="Sunny Day"></div>
</div>

<span class="emoji">üí∞</span> Budget Buddy <span class="emoji">üí∞</span>

<!-- Logout Button (Moved to Header) -->
<button class="btn-logout" id="logout-button" onclick="logout()">
<i class="fas fa-sign-out-alt"></i> Bye Bye!
</button>
</div>

<!-- Main Content Area -->
<div class="section">
<!-- Login Tab -->
<div id="login-tab" class="tab active">
<h2 class="text-2xl font-bold mb-4 text-center" style="color: var(--primary);">Welcome Back Buddy! <span class="emoji">üëã</span></h2>

<div class="card">
<div class="form-group">
<label for="login-username"><i class="fas fa-user"></i> Username</label>
<input type="text" id="login-username" placeholder="Enter your username">
</div>

<div class="form-group">
<label for="login-password"><i class="fas fa-lock"></i> Password</label>
<input type="password" id="login-password" placeholder="Enter your password">
</div>

<div class="flex justify-between items-center mt-4">
<button class="btn" onclick="login()">
<i class="fas fa-sign-in-alt"></i> Login
</button>
<span class="text-sm">New here? <a href="#" class="text-blue-500 font-bold" onclick="showTab('signup-tab')">Sign Up</a></span>
</div>
<div class="text-center mt-4">
<a href="#" class="text-blue-500 font-bold" onclick="showTab('download-ad-tab')">Download Our App!</a>
</div>
</div>
</div>

<!-- Signup Tab -->
<div id="signup-tab" class="tab">
<h2 class="text-2xl font-bold mb-4 text-center" style="color: var(--secondary);">Join Money Buddy! <span class="emoji">üéâ</span></h2>

<div class="card">
<div class="form-group">
<label for="signup-nickname"><i class="fas fa-smile"></i> Nickname</label>
<input type="text" id="signup-nickname" placeholder="What should we call you?">
</div>

<div class="form-group">
<label for="signup-username"><i class="fas fa-user"></i> Username</label>
<input type="text" id="signup-username" placeholder="Choose a username">
</div>

<div class="form-group">
<label for="signup-password"><i class="fas fa-lock"></i> Password</label>
<input type="password" id="signup-password" placeholder="Create a password">
</div>

<div class="flex justify-between items-center mt-4">
<button class="btn btn-secondary" onclick="signup()">
<i class="fas fa-user-plus"></i> Sign Up
</button>
<span class="text-sm">Already have an account? <a href="#" class="text-blue-500 font-bold" onclick="showTab('login-tab')">Login</a></span>
</div>
<div class="text-center mt-4">
<a href="#" class="text-blue-500 font-bold" onclick="showTab('download-ad-tab')">Download Our App!</a>
</div>
</div>
</div>

<!-- Tracker Tab -->
<div id="tracker-tab" class="tab">
<h2 class="text-2xl font-bold mb-4 text-center" style="color: var(--primary);">Student Expenses Tracker <span class="emoji">üìä</span></h2>

<p class="text-center mb-4">Hey <span id="user-nickname" class="font-bold" style="color: var(--accent);">Buddy</span>! Let's track your money! <span class="emoji">üí∏</span></p>

<!-- Smart Card -->
<div class="smart-card">
<h3 class="text-xl font-bold mb-2">Smart Money Tips <span class="emoji">üí°</span></h3>
<ul class="list-disc pl-5">
<li class="mb-1">üìå Save 10% of your allowance first before spending!</li>
<li class="mb-1">üìå Ask yourself: Do I really need this?</li>
<li class="mb-1">üìå Compare prices before buying</li>
<li class="mb-1">üìå Pack your own snacks to save money</li>
<li class="mb-1">üìå Use a piggy bank for coins</li>
</ul>
</div>

<!-- Date Selector -->
<div class="card">
<h3 class="text-xl font-bold mb-2">Select Date <span class="emoji">üìÖ</span></h3>
<input type="date" id="expense-date" class="w-full">
</div>

<!-- Allowance Input -->
<div class="card">
<h3 class="text-xl font-bold mb-2">Today's Allowance <span class="emoji">üíµ</span></h3>
<div class="flex items-center">
<span class="emoji mr-2">‚Ç±</span>
<input type="number" id="allowance-amount" placeholder="Enter your allowance" class="flex-grow">
<button class="btn btn-small ml-2" onclick="addAllowance()">
<i class="fas fa-plus"></i> Add
</button>
</div>

<!-- Savings Goal -->
<div class="mt-2">
<div class="flex justify-between items-center mb-1">
<span class="font-bold">Savings Goal (10%): <span id="savings-goal">‚Ç±0.00</span></span>
<span id="savings-percentage">0%</span>
</div>
<div class="progress-container">
<div id="savings-progress" class="progress-bar" style="width: 0%">0%</div>
</div>
</div>
</div>

<!-- Expenses Input -->
<div class="card">
<h3 class="text-xl font-bold mb-2">Today's Expenses <span class="emoji">üõçÔ∏è</span></h3>

<!-- Transportation -->
<div class="form-group">
<label for="transportation-amount"><i class="fas fa-bus"></i> Transportation</label>
<div class="flex">
<span class="emoji mr-2">‚Ç±</span>
<input type="number" id="transportation-amount" placeholder="How much for transport?" class="flex-grow">
</div>
</div>

<!-- Food -->
<div class="form-group">
<label for="food-amount"><i class="fas fa-hamburger"></i> Meal/Snacks</label>
<div class="flex">
<span class="emoji mr-2">‚Ç±</span>
<input type="number" id="food-amount" placeholder="How much for food?" class="flex-grow">
</div>
</div>

<!-- Other Expenses -->
<div class="form-group">
<label for="other-expense-desc"><i class="fas fa-shopping-bag"></i> Other Expenses</label>
<div class="flex mb-2">
<input type="text" id="other-expense-desc" placeholder="Description" class="flex-grow">
</div>
<div class="flex">
<span class="emoji mr-2">‚Ç±</span>
<input type="number" id="other-expense-amount" placeholder="Amount" class="flex-grow">
<button class="btn btn-small ml-2" onclick="addOtherExpense()">
<i class="fas fa-plus"></i> Add
</button>
</div>
</div>
</div>

<!-- Calculate and Save Button -->
<div class="text-center mb-4">
<button class="btn" onclick="calculateAndSave()">
<i class="fas fa-calculator"></i> Calculate & Save Today!
</button>
</div>

<!-- Summary -->
<div class="card">
<h3 class="text-xl font-bold mb-2">Today's Summary <span class="emoji">üìù</span></h3>
<div class="grid grid-cols-3 gap-2 text-center">
<div class="bg-yellow-100 rounded-lg p-2 border-2 border-yellow-300">
<div class="font-bold">Allowance</div>
<div id="summary-allowance">‚Ç±0.00</div>
</div>
<div class="bg-red-100 rounded-lg p-2 border-2 border-red-300">
<div class="font-bold">Expenses</div>
<div id="summary-expenses">‚Ç±0.00</div>
</div>
<div class="bg-green-100 rounded-lg p-2 border-2 border-green-300">
<div class="font-bold">Savings</div>
<div id="summary-savings">‚Ç±0.00</div>
</div>
</div>

<!-- Daily Summary -->
<div class="mt-3">
<div>Today you have <span id="summary-remaining" class="font-bold">‚Ç±0.00</span> left!</div>
<div class="text-sm motivational-message">Good job <span id="user-nickname-summary" class="font-bold">Buddy</span>! <span id="summary-message"></span></div>
</div>
</div>

<!-- Expense History Table -->
<div class="card">
<div class="flex justify-between items-center mb-2">
<h3 class="text-xl font-bold">Your Expense History <span class="emoji">üìã</span></h3>
<button class="btn btn-small" onclick="loadExpenseHistory()">
<i class="fas fa-sync-alt"></i> Refresh
</button>
</div>

<div class="table-responsive"> <!-- Added wrapper for responsive table -->
<table id="expense-history">
<thead>
<tr>
<th>Date</th>
<th>Allowance (‚Ç±)</th>
<th>Transportation (‚Ç±)</th>
<th>Meal/Snacks (‚Ç±)</th>
<th>Other Expenses (‚Ç±)</th>
<th>Remaining Balance (‚Ç±)</th>
</tr>
</thead>
<tbody>
<!-- Will be populated by JavaScript -->
</tbody>
</table>
</div>
</div>
</div>

<!-- Download Advertisement Tab -->
<div id="download-ad-tab" class="tab">
<h2 class="text-2xl font-bold mb-4 text-center" style="color: var(--primary);">Get Money Buddy on the Go! <span class="emoji">üì±</span></h2>

<div class="download-ad-card">
<div class="emoji-overlay top-left">‚ú®</div>
<div class="emoji-overlay bottom-right">üöÄ</div>
<h2>Your Money, Your Rules, Anywhere!</h2>
<p>Unlock the full power of Money Buddy with our super-duper mobile app! Track, save, and conquer your financial goals with a tap!</p>
<a href="YOUR_GOOGLE_DRIVE_LINK_HERE" target="_blank" class="btn-download">
<i class="fas fa-cloud-download-alt"></i> Download Now!
</a>
<div class="text-center mt-4">
<a href="#" class="text-blue-500 font-bold" onclick="showTab('login-tab')">Back to Login</a>
</div>
</div>
</div>

</div>

<!-- Savings Bubble -->
<div class="savings-bubble" onclick="showSavingsTip()">
<i class="fas fa-lightbulb"></i>
</div>

<script>
// Google Apps Script URL - REPLACE THIS WITH YOUR DEPLOYED WEB APP URL
const scriptUrl = 'https://script.google.com/macros/s/AKfycbwY178foOtTWg0Mbd68Mecb-G5ZBUckPrdHqJt88EudTXC9-rbCUA9o5DYaduwwwxcliw/exec';

// Current user data
let currentUser = null;
let todayData = {
allowance: 0,
transportation: 0,
food: 0,
otherExpenses: [], // Array of {description, amount}
savingsGoal: 0,
savingsActual: 0
};

// DOM Elements
const loginTab = document.getElementById('login-tab');
const signupTab = document.getElementById('signup-tab');
const trackerTab = document.getElementById('tracker-tab');
const downloadAdTab = document.getElementById('download-ad-tab'); // New: Download Ad Tab
const floatingElementsContainer = document.getElementById('floating-elements-container');
const themePicker = document.getElementById('theme-picker');
const root = document.documentElement;
const logoutButton = document.getElementById('logout-button'); // Get the logout button element

// Initialize the app
document.addEventListener('DOMContentLoaded', function() {
// Set today's date as default
const today = new Date();
const dateStr = today.toISOString().split('T')[0];
document.getElementById('expense-date').value = dateStr;

// Load saved theme
const savedTheme = localStorage.getItem('moneyBuddyTheme') || 'rainbow-splash';
applyTheme(savedTheme);

// Check if user is already logged in (from localStorage)
const savedUser = localStorage.getItem('moneyBuddyUser');
if (savedUser) {
currentUser = JSON.parse(savedUser);
showTab('tracker-tab');
updateUserDisplay();
loadTodayData(); // Load data for the current date
loadExpenseHistory(); // Load all history
} else {
// If not logged in, ensure login tab is shown and logout button is hidden
showTab('login-tab');
}

// Generate initial floating elements
generateFloatingElements(20); // Generate 20 elements initially
});

// Tab navigation
function showTab(tabId) {
document.querySelectorAll('.tab').forEach(tab => {
tab.classList.remove('active');
});
document.getElementById(tabId).classList.add('active');
updateHeaderVisibility(tabId); // Call this to manage logout button visibility
}

// Function to manage logout button visibility
function updateHeaderVisibility(activeTabId) {
if (activeTabId === 'login-tab' || activeTabId === 'signup-tab' || activeTabId === 'download-ad-tab') { // Added download-ad-tab
logoutButton.style.display = 'none'; // Hide the logout button
} else {
logoutButton.style.display = 'flex'; // Show the logout button (using flex as per its original display style)
}
}


// --- Backend Communication Helper ---
async function callBackend(action, data = {}) {
const params = new URLSearchParams({
action: action,
data: JSON.stringify(data)
});

try {
// Use POST method for all requests to avoid URL length limits and for better practice
const response = await fetch(scriptUrl, {
method: 'POST',
mode: 'cors', // Required for cross-origin requests
headers: {
'Content-Type': 'application/x-www-form-urlencoded', // Standard for form data
},
body: params.toString() // Send parameters in the request body
});

if (!response.ok) {
throw new Error(`HTTP error! status: ${response.status}`);
}
const result = await response.json();
if (!result.success && result.message) {
// If backend explicitly returns success: false with a message, throw it
throw new Error(result.message);
}
return result;
} catch (error) {
console.error('Backend call failed:', error);
alert(`Oops! Something went wrong: ${error.message}`);
return { success: false, message: error.message }; // Return a consistent error structure
}
}

// Login function
async function login() {
const username = document.getElementById('login-username').value;
const password = document.getElementById('login-password').value;

if (!username || !password) {
alert('Oopsie! üòÖ Please fill in both your username and password to hop in!');
return;
}

// Clear inputs immediately to prevent re-submission of sensitive data
document.getElementById('login-username').value = '';
document.getElementById('login-password').value = '';

const result = await callBackend('login', { username, password });

if (result.success) {
currentUser = result.user;
localStorage.setItem('moneyBuddyUser', JSON.stringify(currentUser));
showTab('tracker-tab');
updateUserDisplay();
await loadTodayData();
await loadExpenseHistory();
alert(`Hooray! üéâ Welcome back, ${currentUser.nickname}! Let's make some money magic! ‚ú®`);
} else {
// Error message already handled by callBackend's alert, but can add specific logic here if needed
// alert(`Login failed: ${result.message}`); // Avoid double alert
}
}

// Signup function
async function signup() {
const nickname = document.getElementById('signup-nickname').value;
const username = document.getElementById('signup-username').value;
const password = document.getElementById('signup-password').value;

if (!nickname || !username || !password) {
alert('Whoops! üôà All fields need a little love! Please fill them all in!');
return;
}

if (password.length < 6) {
alert('Hold on! üõë Your password needs to be at least 6 characters long for super-duper security!');
return;
}

// Clear inputs immediately
document.getElementById('signup-nickname').value = '';
document.getElementById('signup-username').value = '';
document.getElementById('signup-password').value = '';

const result = await callBackend('signup', { nickname, username, password });

if (result.success) {
alert(`Yay! üéâ Welcome to the Money Buddy family, ${nickname}! Your account is ready to roll! Now, let's log in!`);
showTab('login-tab');
} else {
// Error message already handled by callBackend's alert
}
}

// Logout function
function logout() {
currentUser = null;
localStorage.removeItem('moneyBuddyUser');
showTab('login-tab');

// Clear login form (already done in login function, but good to be explicit)
document.getElementById('login-username').value = '';
document.getElementById('login-password').value = '';
alert('See ya later, alligator! üëã You\'ve been logged out.');
}

// Update user display
function updateUserDisplay() {
if (currentUser) {
document.getElementById('user-nickname').textContent = currentUser.nickname;
document.getElementById('user-nickname-summary').textContent = currentUser.nickname;
}
}

// --- Data Persistence Functions (Now using Backend) ---

// Saves today's data to backend
async function saveTodayData() {
if (!currentUser) return;
const date = document.getElementById('expense-date').value;
const result = await callBackend('saveExpense', {
username: currentUser.username,
date: date,
expenseData: todayData
});
if (!result.success) {
console.error('Failed to save expense:', result.message);
// Optionally alert user, but silent failure might be better for auto-save
}
}

// Loads data for the currently selected date into todayData from backend
async function loadTodayData() {
if (!currentUser) return;
const date = document.getElementById('expense-date').value;
const result = await callBackend('loadExpense', {
username: currentUser.username,
date: date
});

if (result.success && result.expenseData) {
todayData = result.expenseData;
// Populate input fields with loaded data
document.getElementById('allowance-amount').value = todayData.allowance > 0 ? todayData.allowance : '';
document.getElementById('transportation-amount').value = todayData.transportation > 0 ? todayData.transportation : '';
document.getElementById('food-amount').value = todayData.food > 0 ? todayData.food : '';
// Note: Other expenses are aggregated in summary, not individually displayed in input fields
document.getElementById('other-expense-desc').value = ''; // Clear for new entry
document.getElementById('other-expense-amount').value = ''; // Clear for new entry
} else {
// Reset todayData if no data for this date or if load failed
todayData = {
allowance: 0,
transportation: 0,
food: 0,
otherExpenses: [],
savingsGoal: 0,
savingsActual: 0
};
// Clear input fields
document.getElementById('allowance-amount').value = '';
document.getElementById('transportation-amount').value = '';
document.getElementById('food-amount').value = '';
document.getElementById('other-expense-desc').value = '';
document.getElementById('other-expense-amount').value = '';
}
updateSummary();
}

// --- Expense Input Functions ---

// Add allowance
async function addAllowance() {
const amount = parseFloat(document.getElementById('allowance-amount').value);
const date = document.getElementById('expense-date').value;

if (isNaN(amount) || amount <= 0) {
alert('Whoops! üòÖ Please enter a super valid allowance amount (more than zero, please!)');
return;
}

todayData.allowance = amount;
todayData.savingsGoal = amount * 0.1; // 10% savings goal

// No immediate save here, will be saved by calculateAndSave
updateSummary();
alert(`Cha-ching! üí∞ Allowance of ‚Ç±${amount.toFixed(2)} added for ${date}! Remember to click 'Calculate & Save Today!'`);
}

// Add transportation expense
async function addTransportationExpense() {
const amount = parseFloat(document.getElementById('transportation-amount').value);

if (isNaN(amount) || amount < 0) {
// alert('Uh oh! üöå Please enter a valid amount for transportation (no free rides here!).');
// return; // Don't return, allow clearing input
}

todayData.transportation = amount;
// No immediate save here, will be saved by calculateAndSave
updateSummary();
// alert(`Zoom! üí® ‚Ç±${amount.toFixed(2)} for transportation added!`); // Too many alerts
}

// Add food expense
async function addFoodExpense() {
const amount = parseFloat(document.getElementById('food-amount').value);

if (isNaN(amount) || amount < 0) {
// alert('Yummy! üçî But please enter a valid amount for your meal/snacks!');
// return; // Don't return, allow clearing input
}

todayData.food = amount;
// No immediate save here, will be saved by calculateAndSave
updateSummary();
// alert(`Nom nom! üòã ‚Ç±${amount.toFixed(2)} for food added!`); // Too many alerts
}

// Add other expense
async function addOtherExpense() {
const description = document.getElementById('other-expense-desc').value;
const amount = parseFloat(document.getElementById('other-expense-amount').value);

if (!description || isNaN(amount) || amount <= 0) {
alert('Whoopsie! üõçÔ∏è Please tell us what you bought and how much it cost (more than zero, please!).');
return;
}

// Ensure otherExpenses is an array
if (!Array.isArray(todayData.otherExpenses)) {
todayData.otherExpenses = [];
}
todayData.otherExpenses.push({
description: description,
amount: amount
});

// No immediate save here, will be saved by calculateAndSave
updateSummary();

document.getElementById('other-expense-desc').value = '';
document.getElementById('other-expense-amount').value = '';
alert(`Cha-ching! üí∏ ‚Ç±${amount.toFixed(2)} for "${description}" added! Remember to click 'Calculate & Save Today!'`);
}

// NEW: Calculate and Save Function
async function calculateAndSave() {
// Ensure all current input values are reflected in todayData before saving
todayData.allowance = parseFloat(document.getElementById('allowance-amount').value) || 0;
todayData.transportation = parseFloat(document.getElementById('transportation-amount').value) || 0;
todayData.food = parseFloat(document.getElementById('food-amount').value) || 0;

// Recalculate savings goal based on current allowance
todayData.savingsGoal = todayData.allowance * 0.1;

// Update summary first to get latest calculations
updateSummary();

// Now save the updated todayData to the backend
await saveTodayData();
alert('Awesome! üéâ Your daily expenses have been calculated and saved!');
await loadExpenseHistory(); // Refresh history after saving
}


// Update summary display
function updateSummary() {
const totalOtherExpenses = todayData.otherExpenses.reduce((sum, expense) => sum + expense.amount, 0);
const totalExpenses = todayData.transportation + todayData.food + totalOtherExpenses;

const remaining = todayData.allowance - totalExpenses;
todayData.savingsActual = Math.max(0, todayData.allowance - totalExpenses);
const savingsPercentage = (todayData.savingsGoal > 0) ? (todayData.savingsActual / todayData.savingsGoal) * 100 : 0;

// Update display
document.getElementById('summary-allowance').textContent = `‚Ç±${todayData.allowance.toFixed(2)}`;
document.getElementById('summary-expenses').textContent = `‚Ç±${totalExpenses.toFixed(2)}`;
document.getElementById('summary-savings').textContent = `‚Ç±${todayData.savingsActual.toFixed(2)}`;
document.getElementById('summary-remaining').textContent = `‚Ç±${remaining.toFixed(2)}`;

// Savings goal
document.getElementById('savings-goal').textContent = `‚Ç±${todayData.savingsGoal.toFixed(2)}`;
const clampedSavingsPercentage = Math.min(100, Math.max(0, savingsPercentage)); // Clamp between 0 and 100
document.getElementById('savings-progress').style.width = `${clampedSavingsPercentage}%`;
document.getElementById('savings-progress').textContent = `${clampedSavingsPercentage.toFixed(0)}%`;
document.getElementById('savings-percentage').textContent = `${clampedSavingsPercentage.toFixed(0)}%`;

// Encouraging message
let message = '';
if (remaining < 0) {
message = "Uh oh! Looks like you went a little overboard today! üòÖ No worries, tomorrow's a fresh start to save like a superstar! ‚ú®";
} else if (clampedSavingsPercentage >= 100) {
message = "YOU ARE A SAVINGS SUPERSTAR! üåü You totally crushed your savings goal! High five! üôå";
} else if (clampedSavingsPercentage >= 75) {
message = "Almost there, Money Master! üöÄ You're so close to hitting your savings goal! Keep up the amazing work! üí™";
} else if (clampedSavingsPercentage >= 50) {
message = "Halfway to Savings Hero status! ü•≥ You're doing great, keep that money magic flowing! üåà";
} else if (clampedSavingsPercentage > 0) {
message = "Every little bit counts! üå± You're planting seeds for a brighter financial future! Keep going, you got this! ‚ú®";
} else {
message = "Let's get those savings started! üöÄ Even a tiny step is a step forward! You can do it! üíñ";
}
document.getElementById('summary-message').textContent = message;
}

// Load expense history from backend
async function loadExpenseHistory() {
if (!currentUser) return;

const result = await callBackend('loadHistory', { username: currentUser.username });

if (result.success && result.history) {
populateExpenseHistory(result.history);
} else {
console.error('Failed to load history:', result.message);
populateExpenseHistory([]); // Clear table if failed
}
}

// Populate expense history table
function populateExpenseHistory(history) {
const tbody = document.querySelector('#expense-history tbody');
tbody.innerHTML = '';

history.sort((a, b) => new Date(b.date) - new Date(a.date)); // Sort by date descending

history.forEach(item => {
const row = document.createElement('tr');

// Format date to MM-DD-YYYY
const dateObj = new Date(item.date);
const formattedDate = `${(dateObj.getMonth() + 1).toString().padStart(2, '0')}-${dateObj.getDate().toString().padStart(2, '0')}-${dateObj.getFullYear()}`;

const dateCell = document.createElement('td');
dateCell.textContent = formattedDate; // Use formatted date

const allowanceCell = document.createElement('td');
allowanceCell.textContent = `‚Ç±${item.allowance.toFixed(2)}`;

const transportationCell = document.createElement('td');
transportationCell.textContent = `‚Ç±${item.transportation.toFixed(2)}`;

const foodCell = document.createElement('td');
foodCell.textContent = `‚Ç±${item.food.toFixed(2)}`;

const otherExpensesCell = document.createElement('td');
otherExpensesCell.textContent = `‚Ç±${item.otherExpenses.toFixed(2)}`;

const remainingBalanceCell = document.createElement('td');
remainingBalanceCell.textContent = `‚Ç±${item.remainingBalance.toFixed(2)}`;
remainingBalanceCell.style.fontWeight = 'bold';
remainingBalanceCell.style.color = item.remainingBalance >= 0 ? 'var(--secondary)' : 'var(--primary)'; // Green for positive, red for negative

row.appendChild(dateCell);
row.appendChild(allowanceCell);
row.appendChild(transportationCell);
row.appendChild(foodCell);
row.appendChild(otherExpensesCell);
row.appendChild(remainingBalanceCell);

tbody.appendChild(row);
});
}

// Show random savings tip
function showSavingsTip() {
const tips = [
"Did you know? Saving just ‚Ç±20 a day adds up to ‚Ç±7,300 a year! That's like a whole new gadget! ü§©",
"Try the 50-30-20 rule: 50% for needs, 30% for wants, and a super smart 20% for savings! You'll be a money wizard! üßô‚Äç‚ôÄÔ∏è",
"Grab a clear jar and watch your coins grow into a treasure chest! It's like magic, but with money! ‚ú®",
"Before you buy something, play the '24-hour wait' game! You might realize you don't need it after all! üòâ",
"Pack your own yummy lunch instead of buying! Your wallet (and taste buds!) will thank you! ü•™",
"Challenge yourself to a 'no-spend' day once a week! It's like a mini-game for your budget! üéÆ",
"Walk or bike if it's safe and close! It's good for your health AND your wallet! Win-win! üö∂‚Äç‚ôÄÔ∏èüö¥‚Äç‚ôÇÔ∏è",
"Make a shopping list and stick to it like glue! No impulse buys allowed! üö´üõçÔ∏è",
"Borrow awesome books from the library instead of buying new ones! Free adventures await! üìö",
"Be a superhero for the planet and your wallet! Turn off lights and unplug chargers! üåçüí°",
"Got a sweet tooth? Make your own treats! It's cheaper and super fun! üç™",
"Look for student discounts everywhere! Your student ID is a money-saving superpower! ü¶∏‚Äç‚ôÇÔ∏è",
"Sell things you don't need anymore! One person's clutter is another's treasure! üíé",
"Track your spending! Knowing where your money goes is the first step to being a money boss! üìù"
];

const randomTip = tips[Math.floor(Math.random() * tips.length)];
alert(`üí° Money Tip for a Smarty Pants! üí°\n\n${randomTip}`);
}

// Event listeners for auto-saving expenses
// Removed auto-save on change for individual expense inputs
// document.getElementById('transportation-amount').addEventListener('change', addTransportationExpense);
// document.getElementById('food-amount').addEventListener('change', addFoodExpense);

// Added event listeners to update todayData and summary on input change, but not save to backend immediately
document.getElementById('allowance-amount').addEventListener('input', function() {
todayData.allowance = parseFloat(this.value) || 0;
todayData.savingsGoal = todayData.allowance * 0.1;
updateSummary();
});
document.getElementById('transportation-amount').addEventListener('input', function() {
todayData.transportation = parseFloat(this.value) || 0;
updateSummary();
});
document.getElementById('food-amount').addEventListener('input', function() {
todayData.food = parseFloat(this.value) || 0;
updateSummary();
});

document.getElementById('expense-date').addEventListener('change', loadTodayData); // Load data for selected date

// --- Theme Picker Logic ---
themePicker.addEventListener('click', function(event) {
const target = event.target;
if (target.classList.contains('theme-dot')) {
const themeName = target.dataset.themeName;
applyTheme(themeName);
localStorage.setItem('moneyBuddyTheme', themeName);
}
});

function applyTheme(themeName) {
// Remove active class from all dots
document.querySelectorAll('.theme-dot').forEach(dot => dot.classList.remove('active'));

// Add active class to the selected dot
const selectedDot = document.querySelector(`.theme-dot[data-theme-name="${themeName}"]`);
if (selectedDot) {
selectedDot.classList.add('active');
}

// Apply theme to the root element
root.dataset.theme = themeName;

// Regenerate floating elements to match new theme colors
generateFloatingElements(20);
}

// --- Dynamic Background Floating Elements Logic ---
function generateFloatingElements(count) {
floatingElementsContainer.innerHTML = ''; // Clear existing elements

for (let i = 0; i < count; i++) {
const element = document.createElement('div');
element.classList.add('floating-element');

const size = Math.random() * 40 + 20; // Size between 20px and 60px
element.style.width = `${size}px`;
element.style.height = `${size}px`;

const startX = Math.random() * 100; // Start anywhere across the width
const startY = Math.random() * 100; // Start anywhere across the height
element.style.left = `${startX}vw`;
element.style.top = `${startY}vh`;

const animationDuration = Math.random() * 10 + 10; // Duration between 10s and 20s
element.style.animationDuration = `${animationDuration}s`;
element.style.animationDelay = `${Math.random() * 5}s`; // Stagger animations

floatingElementsContainer.appendChild(element);
}
}
</script>
</body>
</html>
